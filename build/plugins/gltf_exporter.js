!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";r.r(t);r(2);!function(){const e=new Codec("gltf",{name:"GL Transmission Format (JSON)",extension:"gltf",compile:e=>new Promise(e=>{const t=(new THREE.Vector3).copy(scene.position);scene.position.set(0,0,0),new Promise(e=>{const t=new THREE.GLTFExporter,r=["vertex_handles","outline_group","grid_group","side_grid_x","side_grid_y","sun","lights"],n=[];scene.children.forEach(e=>{r.includes(e.name)||e instanceof THREE.TransformControls||n.push(e)}),t.parse(n,t=>e(t),{binary:!1,embedImages:!0})}).then(r=>{scene.position.copy(t),e(JSON.stringify(r))})}),export(){const e=this;isApp?Blockbench.export({type:this.name,extensions:[this.extension],name:this.fileName(),startpath:this.startPath(),custom_writer:(t,r)=>{e.compile().then(n=>{t=n,Blockbench.writeFile(r,{content:t},t=>e.afterSave(t))})}}):this.compile().then(t=>{Blockbench.export({type:this.name,extensions:[this.extension],name:this.fileName(),content:t},t=>e.afterDownload(t))})}});e.export_action=new Action({id:"export_gltf",name:"Export GLTF (.gltf)",icon:"icon-objects",description:"Export Model to GLTF",category:"file",click:()=>{e.export()}}),Plugin.register("gltf_exporter",{title:"GLTF Exporter",author:"Elenterius",icon:"icon-objects",description:"Export Model to GLTF Fileformat",version:"1.0.0-alpha.1",variant:"both",onload(){MenuBar.addAction(e.export_action,"file.export"),console.log("GLTF Exporter Plugin loaded!")},onunload(){e.export_action.delete(),delete THREE.GLTFExporter}})}()},function(e,t){var r=0,n=1,a=2,i=3,s=4,o=5,l=6,u=5121,c=5123,f=5126,p=5125,h=34962,m=34963,g=9728,d=9729,E=9984,v=9985,y=9986,T=9987,b=33071,x=33648,w=10497,M={};M[THREE.NearestFilter]=g,M[THREE.NearestMipMapNearestFilter]=E,M[THREE.NearestMipMapLinearFilter]=y,M[THREE.LinearFilter]=d,M[THREE.LinearMipMapNearestFilter]=v,M[THREE.LinearMipMapLinearFilter]=T,M[THREE.ClampToEdgeWrapping]=b,M[THREE.RepeatWrapping]=w,M[THREE.MirroredRepeatWrapping]=x;var R={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,t,g){(g=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1},g)).animations.length>0&&(g.trs=!0);var d,E={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},v=0,y=[],T=[],b=new Map,x=[],w={},L={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},F=new Map,H=0;function A(e){return F.has(e)||F.set(e,H++),F.get(e)}function I(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}function S(e){return 4*Math.ceil(e/4)}function N(e,t){t=t||0;var r=S(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var a=e.byteLength;a<r;a++)n[a]=t;return n.buffer}return e}function O(e,t){if(0!==Object.keys(e.userData).length)try{var r=JSON.parse(JSON.stringify(e.userData));if(g.includeCustomExtensions&&r.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[n]=r.gltfExtensions[n],w[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function _(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,w.KHR_texture_transform=!0)}function G(e){return E.buffers||(E.buffers=[{byteLength:0}]),y.push(e),0}function B(e,t,r,n){var a;if(e.array.constructor===Float32Array)a=f;else if(e.array.constructor===Uint32Array)a=p;else if(e.array.constructor===Uint16Array)a=c;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");a=u}if(void 0===r&&(r=0),void 0===n&&(n=e.count),g.truncateDrawRange&&void 0!==t&&null===t.index){var i=r+n,s=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;r=Math.max(r,t.drawRange.start),(n=Math.min(i,s)-r)<0&&(n=0)}if(0===n)return null;var o,l=function(e,t,r){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},a=t;a<t+r;a++)for(var i=0;i<e.itemSize;i++){var s=e.array[a*e.itemSize+i];n.min[i]=Math.min(n.min[i],s),n.max[i]=Math.max(n.max[i],s)}return n}(e,r,n);void 0!==t&&(o=e===t.index?m:h);var d=function(e,t,r,n,a){var i;E.bufferViews||(E.bufferViews=[]),i=t===u?1:t===c?2:4;for(var s=S(n*e.itemSize*i),o=new DataView(new ArrayBuffer(s)),l=0,m=r;m<r+n;m++)for(var g=0;g<e.itemSize;g++){var d=e.array[m*e.itemSize+g];t===f?o.setFloat32(l,d,!0):t===p?o.setUint32(l,d,!0):t===c?o.setUint16(l,d,!0):t===u&&o.setUint8(l,d),l+=i}var y={buffer:G(o.buffer),byteOffset:v,byteLength:s};return void 0!==a&&(y.target=a),a===h&&(y.byteStride=e.itemSize*i),v+=s,E.bufferViews.push(y),{id:E.bufferViews.length-1,byteLength:0}}(e,a,r,n,o),y={bufferView:d.id,byteOffset:d.byteOffset,componentType:a,count:n,max:l.max,min:l.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return E.accessors||(E.accessors=[]),E.accessors.push(y),E.accessors.length-1}function C(e,t,r){L.images.has(e)||L.images.set(e,{});var n=L.images.get(e),a=t===THREE.RGBAFormat?"image/png":"image/jpeg",i=a+":flipY/"+r.toString();if(void 0!==n[i])return n[i];E.images||(E.images=[]);var s={mimeType:a};if(g.embedImages){var o=d=d||document.createElement("canvas");o.width=e.width,o.height=e.height,g.forcePowerOfTwoTextures&&!function(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}(e)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),o.width=THREE.Math.floorPowerOfTwo(o.width),o.height=THREE.Math.floorPowerOfTwo(o.height));var l=o.getContext("2d");!0===r&&(l.translate(0,o.height),l.scale(1,-1)),l.drawImage(e,0,0,o.width,o.height),!0===g.binary?T.push(new Promise((function(e){o.toBlob((function(t){(function(e){return E.bufferViews||(E.bufferViews=[]),new Promise((function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=N(r.result),n={buffer:G(e),byteOffset:v,byteLength:e.byteLength};v+=e.byteLength,E.bufferViews.push(n),t(E.bufferViews.length-1)}}))})(t).then((function(t){s.bufferView=t,e()}))}),a)}))):s.uri=o.toDataURL(a)}else s.uri=e.src;E.images.push(s);var u=E.images.length-1;return n[i]=u,u}function k(e){E.samplers||(E.samplers=[]);var t={magFilter:M[e.magFilter],minFilter:M[e.minFilter],wrapS:M[e.wrapS],wrapT:M[e.wrapT]};return E.samplers.push(t),E.samplers.length-1}function P(e){if(L.textures.has(e))return L.textures.get(e);E.textures||(E.textures=[]);var t={sampler:k(e),source:C(e.image,e.format,e.flipY)};E.textures.push(t);var r=E.textures.length-1;return L.textures.set(e,r),r}function U(e){if(L.materials.has(e))return L.materials.get(e);if(E.materials||(E.materials=[]),e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},w.KHR_materials_unlit=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(I(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var n={index:P(e.metalnessMap)};_(n,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=n}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var a={index:P(e.map)};_(a,e.map),t.pbrMetallicRoughness.baseColorTexture=a}if(e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var i=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(I(i,[0,0,0])||(t.emissiveFactor=i),e.emissiveMap){var s={index:P(e.emissiveMap)};_(s,e.emissiveMap),t.emissiveTexture=s}}if(e.normalMap){var o={index:P(e.normalMap)};-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),o.scale=e.normalScale.x),_(o,e.normalMap),t.normalTexture=o}if(e.aoMap){var l={index:P(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(l.strength=e.aoMapIntensity),_(l,e.aoMap),t.occlusionTexture=l}(e.transparent||e.alphaTest>0)&&(t.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(t.alphaCutoff=e.alphaTest)),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),O(e,t),E.materials.push(t);var u=E.materials.length-1;return L.materials.set(e,u),u}function D(e){var t=e.geometry.uuid+":"+e.material.uuid;if(L.meshes.has(t))return L.meshes.get(t);var u,c=e.geometry;e.isLineSegments?u=n:e.isLineLoop?u=a:e.isLine?u=i:e.isPoints?u=r:(c.isBufferGeometry||(console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead."),c=(new THREE.BufferGeometry).fromGeometry(c)),e.drawMode===THREE.TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),u=l):u=e.drawMode===THREE.TriangleStripDrawMode?e.material.wireframe?i:o:e.material.wireframe?n:s);var f={},p={},h=[],m=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},v=void 0;try{v=c.getAttribute("normal")}catch(e){if(!(e instanceof TypeError))throw e;console.warn(e)}void 0===v||function(e){if(L.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,r=0,n=e.count;r<n;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(v)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),c.addAttribute("normal",function(e){if(L.attributesNormalized.has(e))return L.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,n=0,a=t.count;n<a;n++)r.fromArray(t.array,3*n),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*n);return L.attributesNormalized.set(e,t),t}(v)));var y=null;for(var T in c.attributes)if("morph"!==T.substr(0,5)){var b=c.attributes[T];T=d[T]||T.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(T)||(T="_"+T),L.attributes.has(A(b)))p[T]=L.attributes.get(A(b));else{y=null;var x=b.array;"JOINTS_0"!==T||x instanceof Uint16Array||x instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),y=new THREE.BufferAttribute(new Uint16Array(x),b.itemSize,b.normalized));var w=B(y||b,c);null!==w&&(p[T]=w,L.attributes.set(A(b),w))}}if(void 0!==v&&c.addAttribute("normal",v),0===Object.keys(p).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var M=[],R=[],F={};if(void 0!==e.morphTargetDictionary)for(var H in e.morphTargetDictionary)F[e.morphTargetDictionary[H]]=H;for(var I=0;I<e.morphTargetInfluences.length;++I){var S={},N=!1;for(var T in c.morphAttributes)if("position"===T||"normal"===T){b=c.morphAttributes[T][I];var _=T.toUpperCase(),G=c.attributes[T];if(L.attributes.has(A(b)))S[_]=L.attributes.get(A(b));else{for(var C=b.clone(),k=0,P=b.count;k<P;k++)C.setXYZ(k,b.getX(k)-G.getX(k),b.getY(k)-G.getY(k),b.getZ(k)-G.getZ(k));S[_]=B(C,c),L.attributes.set(A(G),S[_])}}else N||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),N=!0);m.push(S),M.push(e.morphTargetInfluences[I]),void 0!==e.morphTargetDictionary&&R.push(F[I])}f.weights=M,R.length>0&&(f.extras={},f.extras.targetNames=R)}var D=g.forceIndices,z=Array.isArray(e.material);if(z&&0===c.groups.length)return null;!D&&null===c.index&&z&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),D=!0);var V=!1;if(null===c.index&&D){for(var j=[],K=(I=0,c.attributes.position.count);I<K;I++)j[I]=I;c.setIndex(j),V=!0}var J=z?e.material:[e.material],X=z?c.groups:[{materialIndex:0,start:void 0,count:void 0}];for(I=0,K=X.length;I<K;I++){var Y={mode:u,attributes:p};if(O(c,Y),m.length>0&&(Y.targets=m),null!==c.index){t=A(c.index);void 0===X[I].start&&void 0===X[I].count||(t+=":"+X[I].start+":"+X[I].count),L.attributes.has(t)?Y.indices=L.attributes.get(t):(Y.indices=B(c.index,c,X[I].start,X[I].count),L.attributes.set(t,Y.indices)),null===Y.indices&&delete Y.indices}var W=U(J[X[I].materialIndex]);null!==W&&(Y.material=W),h.push(Y)}V&&c.setIndex(null),f.primitives=h,E.meshes||(E.meshes=[]),E.meshes.push(f);var Z=E.meshes.length-1;return L.meshes.set(t,Z),Z}function z(e,t){E.animations||(E.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],a=[],i=0;i<r.length;++i){var s=r[i],o=THREE.PropertyBinding.parseTrackName(s.name),l=THREE.PropertyBinding.findNode(t,o.nodeName),u=R[o.propertyName];if("bones"===o.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(o.objectIndex):void 0),!l||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;var c,f=s.values.length/s.times.length;u===R.morphTargetInfluences&&(f/=l.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(c="CUBICSPLINE",f/=3):c=s.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:B(new THREE.BufferAttribute(s.times,1)),output:B(new THREE.BufferAttribute(s.values,f)),interpolation:c}),n.push({sampler:a.length-1,target:{node:b.get(l),path:u}})}return E.animations.push({name:e.name||"clip_"+E.animations.length,samplers:a,channels:n}),E.animations.length-1}function V(e){var t=E.nodes[b.get(e)],r=e.skeleton,n=e.skeleton.bones[0];if(void 0===n)return null;for(var a=[],i=new Float32Array(16*r.bones.length),s=0;s<r.bones.length;++s)a.push(b.get(r.bones[s])),r.boneInverses[s].toArray(i,16*s);return void 0===E.skins&&(E.skins=[]),E.skins.push({inverseBindMatrices:B(new THREE.BufferAttribute(i,16)),joints:a,skeleton:b.get(n)}),t.skin=E.skins.length-1}function j(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=E.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function K(e){E.nodes||(E.nodes=[]);var t={};if(g.trs){var r=e.quaternion.toArray(),n=e.position.toArray(),a=e.scale.toArray();I(r,[0,0,0,1])||(t.rotation=r),I(n,[0,0,0])||(t.translation=n),I(a,[1,1,1])||(t.scale=a)}else e.matrixAutoUpdate&&e.updateMatrix(),I(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),O(e,t),e.isMesh||e.isLine||e.isPoints){var i=D(e);null!==i&&(t.mesh=i)}else if(e.isCamera)t.camera=function(e){E.cameras||(E.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.Math.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),E.cameras.push(r),E.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)w.KHR_lights_punctual||(E.extensions=E.extensions||{},E.extensions.KHR_lights_punctual={lights:[]},w.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:j(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&x.push(e),e.children.length>0){for(var s=[],o=0,l=e.children.length;o<l;o++){var u=e.children[o];if(u.visible||!1===g.onlyVisible){var c=K(u);null!==c&&s.push(c)}}s.length>0&&(t.children=s)}E.nodes.push(t);var f=E.nodes.length-1;return b.set(e,f),f}function J(e){E.scenes||(E.scenes=[],E.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(t.extras=O(e)),E.scenes.push(t);for(var r=[],n=0,a=e.children.length;n<a;n++){var i=e.children[n];if(i.visible||!1===g.onlyVisible){var s=K(i);null!==s&&r.push(s)}}r.length>0&&(t.nodes=r),O(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof THREE.Scene?J(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);J(t)}(t),r=0;r<x.length;++r)V(x[r]);for(r=0;r<g.animations.length;++r)z(g.animations[r],e[0])}(e),Promise.all(T).then((function(){var e=new Blob(y,{type:"application/octet-stream"}),r=Object.keys(w);if(r.length>0&&(E.extensionsUsed=r),E.buffers&&E.buffers.length>0){E.buffers[0].byteLength=e.size;var n=new window.FileReader;if(!0===g.binary){n.readAsArrayBuffer(e),n.onloadend=function(){var e=N(n.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var a=N(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,n=e.length;r<n;r++){var a=e.charCodeAt(r);t[r]=a>255?32:a}return t.buffer}(JSON.stringify(E)),32),i=new DataView(new ArrayBuffer(8));i.setUint32(0,a.byteLength,!0),i.setUint32(4,1313821514,!0);var s=new ArrayBuffer(12),o=new DataView(s);o.setUint32(0,1179937895,!0),o.setUint32(4,2,!0);var l=12+i.byteLength+a.byteLength+r.byteLength+e.byteLength;o.setUint32(8,l,!0);var u=new Blob([s,i,a,r,e],{type:"application/octet-stream"}),c=new window.FileReader;c.readAsArrayBuffer(u),c.onloadend=function(){t(c.result)}}}else n.readAsDataURL(e),n.onloadend=function(){var e=n.result;E.buffers[0].uri=e,t(E)}}else t(E)}))}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,n=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),i=new e.ValueBufferType(e.values.length+n),s=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){a[0]=t;for(var o=0;o<n;o++)i[o]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;a[0]=t,a.set(e.times,1),i.set(s.evaluate(t),0),i.set(e.values,n),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),i.set(e.values,0),i.set(s.evaluate(t),e.values.length),r=a.length-1}else for(o=0;o<e.times.length;o++){if(Math.abs(e.times[o]-t)<.001)return o;if(e.times[o]<t&&e.times[o+1]>t){a.set(e.times.slice(0,o+1),0),a[o+1]=t,a.set(e.times.slice(o+1),o+2),i.set(e.values.slice(0,(o+1)*n),0),i.set(s.evaluate(t),(o+1)*n),i.set(e.values.slice((o+1)*n),(o+2)*n),r=o+1;break}}return e.times=a,e.values=i,r},mergeMorphTargetTracks:function(e,t){for(var r=[],n={},a=e.tracks,i=0;i<a.length;++i){var s=a[i],o=THREE.PropertyBinding.parseTrackName(s.name),l=THREE.PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"===o.propertyName&&void 0!==o.propertyIndex){if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(s=s.clone()).setInterpolation(THREE.InterpolateLinear)}var u,c=l.morphTargetInfluences.length,f=l.morphTargetDictionary[o.propertyIndex];if(void 0===f)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);if(void 0!==n[l.uuid]){var p=s.createInterpolant(new s.ValueBufferType(1));u=n[l.uuid];for(g=0;g<u.times.length;g++)u.values[g*c+f]=p.evaluate(u.times[g]);for(g=0;g<s.times.length;g++){var h=this.insertKeyframe(u,s.times[g]);u.values[h*c+f]=s.values[g]}}else{for(var m=new((u=s.clone()).ValueBufferType)(c*u.times.length),g=0;g<u.times.length;g++)m[g*c+f]=u.values[g];u.name=".morphTargetInfluences",u.values=m,n[l.uuid]=u,r.push(u)}}else r.push(s)}return e.tracks=r,e}}}]);